"use strict";(()=>{var e={};e.id=264,e.ids=[264],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},42556:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{POST:()=>m,dynamic:()=>p});var a=r(79182),i=r(72007),n=r(56719),o=r(93442),d=r(57978),l=r(11826),u=r(83178);let p="force-dynamic";async function m(e){try{let t=await (0,d.getServerSession)(l.L);if(!t)return o.NextResponse.json({message:"Unauthorized"},{status:401});let{progressId:r,section:s,ntReadingTimeSeconds:a,otReadingTimeSeconds:i,totalReadingTimeSeconds:n,readingTimeSeconds:p}=await e.json();if(!r)return o.NextResponse.json({message:"Progress ID is required"},{status:400});let m=await u._.readingProgress.findUnique({where:{id:r},include:{dailyReading:!0}});if(!m)return o.NextResponse.json({message:"Progress not found"},{status:404});let c={},g=new Date;"nt"===s?(c={ntCompleted:!0,ntCompletedAt:g,ntReadingTimeSeconds:a||null,totalReadingTimeSeconds:n||null},(m.otCompleted||!m.dailyReading.otPassages?.length)&&(c.isCompleted=!0,c.completedAt=g)):"ot"===s?(c={otCompleted:!0,otCompletedAt:g,otReadingTimeSeconds:i||null,totalReadingTimeSeconds:n||null},(m.ntCompleted||!m.dailyReading.ntPassages?.length)&&(c.isCompleted=!0,c.completedAt=g)):c={ntCompleted:!0,ntCompletedAt:g,ntReadingTimeSeconds:a||null,otCompleted:!0,otCompletedAt:g,otReadingTimeSeconds:i||null,isCompleted:!0,completedAt:g,totalReadingTimeSeconds:n||p||null,readingTimeSeconds:n||p||null};let w=await u._.readingProgress.update({where:{id:r},data:c,include:{dailyReading:!0}}),x=new Date;x.setHours(0,0,0,0);let h=await u._.readingStreak.findUnique({where:{userId:t.user.id}});if(h){let e=h.lastReadingDate?new Date(h.lastReadingDate):null;e&&e.setHours(0,0,0,0);let r=1;if(e){let t=Math.floor((x.getTime()-e.getTime())/864e5);r=1===t?h.currentStreak+1:0===t?h.currentStreak:1}await u._.readingStreak.update({where:{userId:t.user.id},data:{currentStreak:r,longestStreak:Math.max(h.longestStreak,r),lastReadingDate:x}})}let q=(await u._.readingProgress.findMany({where:{userId:t.user.id,isCompleted:!0}})).length,f=await u._.achievement.findMany(),y=f.filter(e=>"milestone"===e.category&&q>=e.requiredCount),R=await u._.readingStreak.findUnique({where:{userId:t.user.id}}),S=f.filter(e=>"streak"===e.category&&(R?.currentStreak||0)>=e.requiredCount),v=[...y,...S];for(let e of v)await u._.userAchievement.upsert({where:{userId_achievementId:{userId:t.user.id,achievementId:e.id}},update:{},create:{userId:t.user.id,achievementId:e.id}});return o.NextResponse.json({message:"Reading marked as complete",progress:w,newAchievements:v.length})}catch(e){return console.error("Progress complete API error:",e),o.NextResponse.json({message:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/progress/complete/route",pathname:"/api/progress/complete",filename:"route",bundlePath:"app/api/progress/complete/route"},resolvedPagePath:"/home/ubuntu/berean-bible-app/app/app/api/progress/complete/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:x}=c,h="/api/progress/complete/route";function q(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:w})}},11826:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(64617),a=r(66291),i=r(81304),n=r(83178);let o={adapter:(0,s.N)(n._),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await n._.user.findUnique({where:{email:e.email}});return t&&t.password&&await i.ZP.compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id),e)},secret:process.env.NEXTAUTH_SECRET}},83178:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[30,249,472,609],()=>r(42556));module.exports=s})();